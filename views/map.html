<!DOCTYPE html>

<html>
    <head>
	    <title>Detention Map</Title>
	    <link rel="stylesheet" href="leaflet/leaflet.css" />
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<link href="jumbotron-narrow.css" rel="stylesheet">
        <script src="leaflet/leaflet.js"></script>
        <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
        <style>
        body {padding: 0; margin: 0 }
        html, body { height: 100% }
        </style>
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<style>
            #map { height: 400px;
                   width: 800px;
            }
        </style>
	</head>
	<body>	
	
	  <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand" id="lead">Texas Immigrant Detention Centers</span>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <div class="navbar-form navbar-right">
			  <button type="submit" class="btn btn-success" id="english">English</button>
              <button type="submit" class="btn btn-success" id="spanish">Español</button>
            </div>
          </div><!--/.navbar-collapse -->
        </div>
      </nav>	

	  <div class="jumbotron">
        <div class="container" id="map">
        </div>
		
      </div>
	  
      <div class="container">
        <div class="row">
          <div>
            <h2 id="some_text"></h2>
            <p id="info-1"></p>
            <p id="info-2"></p>
			<p id="info-3"></p>
         </div>
        </div>
	  </div>  
	  
	
	
	<script type ="text/javascript">
		var language = "english";
		var currentId;
		$("#english").click(function() {
		    language = "english";
			console.log("the language is now " + language);
			switchToEnglish();
		});
		$("#spanish").click(function() {
		    language = "spanish";
			console.log("the language is now " + language);
			switchToSpanish();
		});
		
		
	    // create a tile layer sourced from mapbox
	    var basemap = L.tileLayer('https://{s}.tiles.mapbox.com/v4/gsvaldes.lc42jp9d/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZ3N2YWxkZXMiLCJhIjoia1R4QjhCVSJ9.dT6pDZZcysDY3zifgWGhVg#6')
		

		var points;
		$.getJSON('data/det-centers.json', function (data){
			var map = L.map('map').setView([30.260, -97.770], 7);
			basemap.addTo(map);
		    var geojson = L.geoJson(data, {
			    onEachFeature: function (feature, layer) {
				    layer.bindPopup(feature.properties.name + '<br />' + feature.properties.city);
					
					layer.on('click', function (e) {              // add click event to every feature
					    markerClick(feature);
						getCenterData(feature.properties.id);
                    });
                  }
                });
			geojson.addTo(map);
		});	
		
		
		
		function markerClick(feature){
		    console.log('a marker has been clicked' + feature.properties.name);
			$('#some_text').text(feature.properties.name);
		}
		
		function getCenterData(id){
		    $.getJSON('data/' + id + '.json', function (data){
			    $("#info-1").text(data[language].par1);
				$("#info-2").text(data[language].par2);
				$("#info-3").text(data[language].par3);
				currentId = id;
			    console.log(data[language].par1);
				console.log(data.spanish)	
            });				
		}
		
		function switchToEnglish(){
		    $("#lead").text("Texas Immigrant Detention Centers");
			getCenterData(currentId);
		}
		
		function switchToSpanish(){
		    $("#lead").text("Centros de detención de inmigrantes");
			getCenterData(currentId);
		}
		
	</script>
	</body>
	
</html>